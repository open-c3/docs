
# 1 资源托管

简介

运维平台使用的第一步，我们需要把要管理的资源先托管到平台中。需要把你的公有云帐号、私有云帐号、或者IDC资源先托管到平台中。平台会定时的进行同步。

托管进来的资源需要一个合适的分组，需要跟进业务情况配置好服务树的结构，然后把资源挂载到对应的服务树上。这样监控系统、发布系统等就可以方便的获取分组的资源。业务后续添加或回收资源，只要在服务树上进行对应操作即可，不用调整监控和发布的配置。

## 1.1 资源帐号导入

在“管理”->“CMDB”菜单。导入自己的云帐号

![](/attachments/20250706220344_wps17.jpg) 

![](/attachments/20250706220344_wps18.jpg) 

如果想调整资源同步的频率，可以在”管理”->”系统参数”中进行修改

![](/attachments/20250706220344_wps19.jpg) 

## 1.2 服务树编辑

服务树是一个很重要的概念，这里我们按照业务情况创建服务树。

在”管理”->”编辑服务树节点” 菜单。这里我们可以右键选择服务树节点来创建和删除节点。

推荐的服务树结构，你可以跟进企业的业务的复杂度进行选择：

类型一：

ROOT-> 子公司 ->事业部-> 部门 -> 服务 -> 模块

类型二:

ROOT-> 事业部-> 部门 -> 服务 -> 模块

类型三:

ROOT-> 部门 -> 服务 -> 模块

![](/attachments/20250706220344_wps20.jpg) 

## 1.3 资源自动挂树

自动同步下来的资源没有挂树，根据下面的配置把资源自动的挂载到某些服务树下。

默认pool节点

一般我们会创建一个服务树节点，如: ROOT -> 企业 -> pool 或者 ROOT -> pood

新创建出来没有挂服务树的资源自动的挂到该节点上，根据下面的配置来完成

# cat /data/open-c3/AGENT/device/conf/config.defaulttree.private

default: xxx.pool

注: 其中xxx.pool 就是你想挂载的服务树， 不用写ROOT的部分。 

这样就可以通过查看pool节点的资源，清楚知道哪些资源没有挂树，也可以在pool节点上配置监控策略等。

根据资源特点自动分类

方式1：

通过配置/data/open-c3-data/buildintree/v2.yml文件来实现。

下面以华为CCE（CCE是华为云上的KUBERNETES服务）节点为例子

cat /data/open-c3-data/buildintree/v2.yml

compute:

  huawei-ecs:

   - tree: xxx.ops.cce.xx-backend-cluster

     match:

      - [ 'tags', '/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/' ]

      - [ 'tags', '/CCE/' ]

   - tree: xxx.ops.cce.xx-bigdata-cluster

     match:

      - [ 'tags', '/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/' ]

      - [ 'tags', '/CCE/' ]

   - tree: xxxx.ops.cce.unknown

     match:

      - [ 'tags', '/CCE/' ]

这样配置后，CCE节点池自动扩缩容时，资源挂树的动作会自动完成。

方式2:

通过云资源tags来控制。

云资源上是可以打标签（tags）。 如果云资源上存在名为“tree”的标签。 Open-C3会跟进这个标签来挂树， 比如资源有一个tags名为tree,值为 xxx.ops 。那么资源同步到CMDB后，会自动挂到xxx.ops服务树下。

## 1.4 资源手动挂树

可以勾选资源ID前面到选择框对资源进行挂树操作。

复制到： 资源是可以同时挂在多个服务树上的，“复制到”按钮会把该资源复制到其他服务树，点击后会出现服务树选择的弹窗，选择服务树后，资源会被服务树到该服务树上。

移动到： “移动到”和“复制到”的区别是，操作完后，该资源会被移动到目标服务树，同时会在当前服务树中移除，是一个移动的动作。

归还: 资源归还后，会回到默认的pood节点。

![](/attachments/20250706220344_wps21.jpg) 

## 1.5 总结

通过上面的操作后，CMDB基本完成，可以对资源进行挂树，可以查看资源，搜索资源。也可以选择时间查看某个历史时刻的资源详情。

如果你用的不是云资源，可以在“管理”-> “CMDB”菜单 中选择idc类型，把你的资源托管到CMDB中。

为了让这个文章更连贯，这里先不展开讲怎么添加自定义的资源，怎么使用服务分析功能。在后续的其他章节中在展开。