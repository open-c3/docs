
# 1 主机基础监控

简介

主机监控是一个最常见的监控类型。根据主机监控的添加，能更好的理解监控系统的整个配置过程。

## 1.1 安装AGENT

打开”业务管理”->”代理设置(AGENT安装)”页面。

![](/attachments/20250706221017_wps22.jpg) 

Open-C3中和主机相关的有两个AGENT，一个是发布的AGENT（截图中的“安装AGENT”）一个是监控的AGENT（截图中的“安装AGENT MON”）。

有的企业只用到Open-C3的监控功能，有的企业可能只用Open-C3的发布功能。所以这里目前这两个AGENT是独立安装的。但是目前监控AGENT依赖发布AGENT的文件，所以这里先把监控和发布的都进行安装。不想启动发布AGENT的，在把发布AGENT停掉。

根据截图中的链接，把发布AGENT和监控AGENT安装上。

## 1.2 监控看板

安装完后，我们可以到“监控”->”监控看板”中查看资源的监控看板。Open-C3会根据你点击的服务树的深度，显示不一样的看板。

![](/attachments/20250706221017_wps23.jpg) 

![](/attachments/20250706221017_wps24.jpg) 

## 1.3 配置消息出口

Open-C3系统会对外发送三种消息，邮件、短信（短信、飞书消息、钉钉消息等都归为同一类）、语言电话。

同时Open-C3提供了不同的方式对接。主要分为连接器对接和直接对接。连接器对接是设想企业中应该有发送这三类消息的接口，把这些接口配置到Open-C3的连接器配置中即可【当然Open-C3的接口需要符合一定的格式】。

连接器对接方式

到“管理”->”设置连接器”页面设置消息出口。

![](/attachments/20250706221017_wps25.jpg) 

消息出口需要appname和appkey完成验证【添加http的Header】。

**I )** **邮****件**
```
配置的地址示例:

http://api.connector.open-c3.org/default/mail

调用方式：POST

参数

user：用户名，接口需要自己查询对应的用户的邮箱地址

title: 邮件标题

content: 邮件内容
```

返回：{ stat： true }

**II )** **短****信**

```
配置的地址如下:

http://api.connector.open-c3.org/default/mesg

调用方式：POST

参数

user：用户名，接口需要自己查询对应的用户的手机号

mesg: 短信内容

```

返回：{ stat： true }

**III )** **语****音**
```
配置的地址如下:

http://api.connector.open-c3.org/default/mesg

#使用内置是和短信接口一样

调用方式：POST

参数

user：用户名，接口需要自己查询对应的用户的手机号

mesg: 语音内容
```


返回：{ stat： true }

直接对接方式

**I )** **邮件**

到“管理”->”系统参数”配置邮件配置。

![](/attachments/20250706221017_wps26.jpg) 

**II )** **短信**

短信目前支持飞书、钉钉、Lark

v 钉钉：

![](/attachments/20250706221017_wps27.jpg) 

v 飞书：

飞书到配置文件 /data/open-c3-data/sysctl.conf 中配置 sys.send.feishu.app_id 和 sys.send.feishu.app_secret 字段

v Lark：

Lark到配置文件 /data/open-c3-data/sysctl.conf 中配置 sys.send.lark.app_id 和 sys.send.lark.app_secret字段

**III )** **语音**

语言目前只支持连接器对接的方式。

## 1.4 消息模版

如果不配置模版，发送出来的内容会很简单。这里需要到“管理”->”模版管理”页面配置一下告警消息的模版。

如果不想做太多调整，直接点击右上角的复制模版按钮，复制出标准模版然后保存即可。

![](/attachments/20250706221017_wps28.jpg) 

## 1.5 消息总开关

系统设计了消息总开关，确保消息开关是开启的状态，到“管理”->”通知管理”把告警系统的全部勾选上。

![](/attachments/20250706221017_wps29.jpg) 

## 1.6 地址簿管理

在“配置消息出口”章节中，我们定义了三个消息出口。当我们在配置告警的时候，最简单的例子是我们通过用户名称来配置告警接收人，比如 zhangsan 。

系统在把消息往外发送之前，会在地址簿里面查找有没有定义该用户的地址簿。如果有，会根据地址簿中的配置做一层转换。

举个例子：

   当前短信出口，我们用的是连接器的方式。如果不配置地址簿，当我们给zhangsan发送短信消息的时候，传递给短信接口的用户这个字段的内容是“zhangsan”。 这样就要靠短信接口自己寻找zhangsan的手机号然后发送短信。这个也是合理的方式，有的企业的消息出口就是根据用户名来发送消息的，他们会查询自己公司的OA系统来找用户的手机号然后发送消息。 但是如果我们配置了地址簿，比如地址簿中我配置了zhangsan的手机号是133xxxxxxxx , 那么在调用短信接口的时候，用户的字段就变成133xxxxxxxx。

同时，系统提供了一下简单的消息发送的方式，比如飞书机器人，这个不需要预先配置任何东西，在飞书上创建机器人后，在地址簿的消息

![](/attachments/20250706221017_wps30.jpg) 

## 1.7 监控策略

在对应服务树上配置监控策略，进到“监控”-> “监控配置”页面，点击对应的服务树。监控策略是配置在服务树上的，资源也是挂载到服务树上。 所以正常情况下，你想这个策略监控哪个服务树上的资源，就到那个服务树上配置监控策略。

注： ROOT节点的服务树不允许配置监控策略。

首次使用，可以直接从“通过模版添加监控策略”来导入一些常用的监控策略。

![](/attachments/20250706221017_wps31.jpg) 

## 1.8 配置告警接收人

监控策略是绑定在服务树上的，告警接收人也是绑定在服务树上的。所以想接收哪个服务树上的告警，就到“监控”->“监控配置”中添加保荐人即可。 这里可以填写地址簿中之前添加的用户。

![](/attachments/20250706221017_wps32.jpg) 

## 1.9  接收告警

通过上述配置后，当告警发生的时候，就会收到对应的邮件、短信、电话语言。下面是飞书收到消息的例子。

![](/attachments/20250706221017_wps33.jpg) 

## 1.10  查看当前告警列表

可以到“监控”-> “当前告警”页面查看当前正在发生的告警。

![](/attachments/20250706221017_wps34.jpg) 

（当前告警页面）

## 1.11  总结

这个章节我们主要讲了主机监控的配置，为了更简洁与连贯，我们没有展开讲关于告警组、策略分组、策略的不同配置方式等。