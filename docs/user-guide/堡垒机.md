
# 说明

Open-C3提供了同步脚本，把Open-C3中CMDB资源同步到JumpServer堡垒机中。

同步的资源包括： 服务器资源、服务树资源、权限

# 使用方式

```
1. 下载工具

cd /data
git clone https://github.com/open-c3/open-c3-jumpserver.git

2. 配置config.ini
   
参照 config.ini.example 配置自己的config.ini, 内容如下

[JumpServer]
weburl = http://192.168.1.100                 # JumpServer的地址
key_id = ee74c13a-a556-5a28-b9e1-e71896e7e98a # JumpServer 的 key id
secret = FUUId0Dfcji1M5uoLKx7uWzzKHVQey1d2RXK # JumpServer的 secret

[OpenC3]
api_url = http://192.168.1.200                # Open-C3的地址
api_key = 2481727108384729495110827462924629  # Open-C3 的key

[Templates] # 默认模版
template_id = 409274ce-67fb-4e5c-bed3-2a91534358d4 # 模版ID
account_name = c3-default                          # 模版名称

[Template_1] # 设置其他模版，可以给网段定义自己的账号模版
cidr = 192.168.1.0/24                               # 网段，多个网段用逗号分隔
template_id = c90f65cc-5b61-753d-a1e6-fc89763bd271  # 模版ID
account_name = 'work'                               # 模版名称

3. 创建python的 venv
   python3 -m venv venv
4. 安装依赖
   ./venv/bin/pip3 install -r requirements.txt 
5. 执行同步
   ./run.sh
```


# 同步效果
## 资源和服务树的同步

同步后，JumpServer上有一样的服务树，服务树上有一样的主机资源。

注： 默认情况下，Open-C3的资源会同步到JumpServer的/DEFAULT/C3/ 服务下。如果Open-C3中的资源和服务树进行了删除，会同步进行删除。 但是不会影响 /DEFAULT/C3 以外的其他服务树。


![](/attachments/Pasted_image_20250914172516.png)


![](/attachments/Pasted_image_20250914172437.png)

## 权限同步

同步后，会在JumpServer上创建资产授权配置。 如果Open-C3上删除了权限，在JumpServer上也会同步删除。同步过去的配置名称以“C3_” 为前缀。 同步工具不会删除非“C3_” 前缀的配置。

![](/attachments/Pasted_image_20250914172717.png)

![](/attachments/Pasted_image_20250914172735.png)
